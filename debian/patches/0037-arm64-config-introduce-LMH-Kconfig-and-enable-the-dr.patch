From: Joel Selvaraj <jo@jsfamily.in>
Date: Thu, 6 May 2021 10:00:43 +0530
Subject: [PATCH 42/45] arm64: config: introduce LMH Kconfig and enable the
 driver

---
 arch/arm64/configs/sdm845.config |  2 ++
 drivers/thermal/qcom/Kconfig     | 10 ++++++++++
 drivers/thermal/qcom/Makefile    |  2 +-
 3 files changed, 13 insertions(+), 1 deletion(-)

diff --git a/arch/arm64/configs/sdm845.config b/arch/arm64/configs/sdm845.config
index 1928085..a341cda 100644
--- a/arch/arm64/configs/sdm845.config
+++ b/arch/arm64/configs/sdm845.config
@@ -87,6 +87,8 @@ CONFIG_I2C_HID=y
 CONFIG_SND_SOC_WCD9335=m
 CONFIG_POWER_RESET_QCOM_PON=y
 CONFIG_QCOM_SPMI_TEMP_ALARM=y
+CONFIG_QCOM_THERMAL_LIMITS_DCVS=y
+
 #CONFIG_DRM=y
 #CONFIG_DRM_MSM=y
 #CONFIG_DRM_MSM_REGISTER_LOGGING=y
diff --git a/drivers/thermal/qcom/Kconfig b/drivers/thermal/qcom/Kconfig
index 8d5ac2d..fa6e08d 100644
--- a/drivers/thermal/qcom/Kconfig
+++ b/drivers/thermal/qcom/Kconfig
@@ -31,3 +31,13 @@ config QCOM_SPMI_TEMP_ALARM
 	  trip points. The temperature reported by the thermal sensor reflects the
 	  real time die temperature if an ADC is present or an estimate of the
 	  temperature based upon the over temperature stage value.
+
+config QCOM_THERMAL_LIMITS_DCVS
+	tristate "QCOM LMH DCVS driver"
+	depends on OF && QCOM_SCM
+	help
+	  This enables the driver for Limits Management Hardware - DCVS block
+	  for the application processors. The h/w block that is available for
+	  each cluster can be used to perform quick thermal mitigations by
+	  tracking temperatures of the CPUs and taking thermal action in the
+	  hardware without s/w intervention.
diff --git a/drivers/thermal/qcom/Makefile b/drivers/thermal/qcom/Makefile
index d6f500c..6edbe44 100644
--- a/drivers/thermal/qcom/Makefile
+++ b/drivers/thermal/qcom/Makefile
@@ -5,4 +5,4 @@ qcom_tsens-y			+= tsens.o tsens-v2.o tsens-v1.o tsens-v0_1.o \
 				   tsens-8960.o
 obj-$(CONFIG_QCOM_SPMI_ADC_TM5)	+= qcom-spmi-adc-tm5.o
 obj-$(CONFIG_QCOM_SPMI_TEMP_ALARM)	+= qcom-spmi-temp-alarm.o
-obj-y					+= lmh.o
+obj-$(CONFIG_QCOM_THERMAL_LIMITS_DCVS)	+= lmh.o
